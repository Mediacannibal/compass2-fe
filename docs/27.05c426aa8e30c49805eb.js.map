{"version":3,"sources":["webpack:///./node_modules/sdp/sdp.js","webpack:///./node_modules/webrtc-adapter/src/js/utils.js","webpack:///./node_modules/webrtc-adapter/src/js/chrome/getusermedia.js","webpack:///./node_modules/webrtc-adapter/src/js/chrome/getdisplaymedia.js","webpack:///./node_modules/webrtc-adapter/src/js/chrome/chrome_shim.js","webpack:///./node_modules/webrtc-adapter/src/js/edge/getusermedia.js","webpack:///./node_modules/webrtc-adapter/src/js/edge/getdisplaymedia.js","webpack:///./node_modules/webrtc-adapter/src/js/edge/edge_shim.js","webpack:///./node_modules/webrtc-adapter/src/js/edge/filtericeservers.js","webpack:///./node_modules/webrtc-adapter/src/js/firefox/getusermedia.js","webpack:///./node_modules/webrtc-adapter/src/js/firefox/getdisplaymedia.js","webpack:///./node_modules/webrtc-adapter/src/js/firefox/firefox_shim.js","webpack:///./node_modules/webrtc-adapter/src/js/safari/safari_shim.js","webpack:///./node_modules/webrtc-adapter/src/js/common_shim.js","webpack:///./node_modules/webrtc-adapter/src/js/adapter_core.js","webpack:///./node_modules/webrtc-adapter/src/js/adapter_factory.js"],"names":["SDPUtils","Math","random","toString","substr","localCName","generateIdentifier","splitLines","blob","trim","split","map","line","splitSections","part","index","getDescription","sections","getMediaSections","shift","matchPrefix","prefix","filter","indexOf","parseCandidate","parts","candidate","foundation","substring","component","parseInt","protocol","toLowerCase","priority","ip","address","port","type","i","length","relatedAddress","relatedPort","tcpType","ufrag","usernameFragment","writeCandidate","sdp","push","toUpperCase","join","parseIceOptions","parseRtpMap","parsed","payloadType","name","clockRate","channels","numChannels","writeRtpMap","codec","pt","undefined","preferredPayloadType","parseExtmap","id","direction","uri","writeExtmap","headerExtension","preferredId","parseFmtp","kv","j","writeFmtp","parameters","Object","keys","params","forEach","param","parseRtcpFb","parameter","writeRtcpFb","lines","rtcpFeedback","fb","parseSsrcMedia","sp","ssrc","colon","attribute","value","parseSsrcGroup","semantics","ssrcs","getMid","mediaSection","mid","parseFingerprint","algorithm","getDtlsParameters","sessionpart","role","fingerprints","writeDtlsParameters","setupType","fp","parseCryptoLine","tag","cryptoSuite","keyParams","sessionParams","slice","writeCryptoLine","writeCryptoKeyParams","parseCryptoKeyParams","keyMethod","keySalt","lifeTime","mkiValue","mkiLength","getCryptoParameters","getIceParameters","pwd","password","writeIceParameters","parseRtpParameters","description","codecs","headerExtensions","fecMechanisms","rtcp","mline","rtpmapline","fmtps","writeRtpDescription","kind","caps","maxptime","extension","parseRtpEncodingParameters","secondarySsrc","encodingParameters","hasRed","hasUlpfec","primarySsrc","flows","apt","encParam","codecPayloadType","rtx","JSON","parse","stringify","fec","mechanism","bandwidth","maxBitrate","parseRtcpParameters","rtcpParameters","remoteSsrc","obj","cname","rsize","reducedSize","compound","mux","parseMsid","spec","stream","track","planB","msidParts","parseSctpDescription","maxMessageSize","parseMLine","maxSizeLine","isNaN","sctpPort","fmt","writeSctpDescription","media","sctp","output","generateSessionId","writeSessionBoilerplate","sessId","sessVer","sessUser","version","writeMediaSection","transceiver","iceGatherer","getLocalParameters","dtlsTransport","rtpSender","rtpReceiver","msid","sendEncodingParameters","getDirection","getKind","isRejected","parseOLine","username","sessionId","sessionVersion","netType","addressType","isValidSDP","charAt","module","exports","logDisabled_","deprecationWarnings_","extractVersion","uastring","expr","pos","match","wrapPeerConnectionEvent","window","eventNameToWrap","wrapper","RTCPeerConnection","proto","prototype","nativeAddEventListener","addEventListener","nativeEventName","cb","apply","this","arguments","wrappedCallback","e","modifiedEvent","handleEvent","_eventMap","Map","set","nativeRemoveEventListener","removeEventListener","has","unwrappedCb","get","delete","size","defineProperty","enumerable","configurable","disableLog","bool","Error","disableWarnings","log","console","deprecated","oldMethod","newMethod","warn","detectBrowser","result","browser","navigator","mozGetUserMedia","userAgent","webkitGetUserMedia","isSecureContext","webkitRTCPeerConnection","RTCIceGatherer","mediaDevices","supportsUnifiedPlan","RTCRtpTransceiver","isObject","val","call","compactObject","data","reduce","accumulator","key","isObj","isEmptyObject","assign","filterStats","outbound","streamStatsType","filteredResult","trackStats","trackIdentifier","trackStat","stats","trackId","walkStats","base","resultSet","endsWith","shimGetUserMedia","browserDetails","constraintsToChrome_","c","mandatory","optional","cc","r","ideal","exact","min","max","oldname_","oc","mix","advanced","concat","shimConstraints_","constraints","func","audio","remap","a","b","video","face","facingMode","getSupportedFacingModeLies","getSupportedConstraints","matches","enumerateDevices","then","devices","dev","d","find","some","label","includes","deviceId","shimError_","PermissionDeniedError","PermissionDismissedError","InvalidStateError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","TabCaptureError","ScreenCaptureError","DeviceCaptureError","message","constraint","constraintName","getUserMedia","onSuccess","onError","bind","origGetUserMedia","cs","getAudioTracks","getVideoTracks","getTracks","stop","DOMException","Promise","reject","shimGetDisplayMedia","getSourceId","getDisplayMedia","sourceId","widthSpecified","width","heightSpecified","height","frameRateSpecified","frameRate","chromeMediaSource","chromeMediaSourceId","maxFrameRate","maxWidth","maxHeight","error","shimMediaStream","MediaStream","webkitMediaStream","shimOnTrack","_ontrack","f","origSetRemoteDescription","setRemoteDescription","_ontrackpoly","te","receiver","getReceivers","event","Event","streams","dispatchEvent","shimGetSendersWithDtmf","shimSenderWithDtmf","pc","_dtmf","createDTMFSender","_pc","getSenders","_senders","origAddTrack","addTrack","sender","origRemoveTrack","removeTrack","idx","splice","origAddStream","addStream","origRemoveStream","removeStream","s","RTCRtpSender","origGetSenders","senders","shimGetStats","origGetStats","getStats","selector","onSucc","onErr","fixChromeStats_","response","standardReport","report","standardStats","timestamp","localcandidate","remotecandidate","names","stat","makeMapStats","successCallbackWrapper_","resolve","shimSenderReceiverGetStats","RTCRtpReceiver","origGetReceivers","receivers","srcElement","MediaStreamTrack","err","shimAddTrackRemoveTrackWithNative","getLocalStreams","_shimmedLocalStreams","streamId","existingSenders","newSenders","newSender","shimAddTrackRemoveTrack","origGetLocalStreams","nativeStreams","_reverseStreams","_streams","newStream","replaceInternalStreamId","internalId","externalStream","internalStream","replace","RegExp","RTCSessionDescription","replaceExternalStreamId","signalingState","t","alreadyExists","oldStream","method","nativeMethod","methodObj","args","desc","origSetLocalDescription","setLocalDescription","origLocalDescription","getOwnPropertyDescriptor","streamid","shimPeerConnection","addIceCandidateNullSupported","addIceCandidate","RTCIceCandidate","nativeAddIceCandidate","fixNegotiationNeeded","target","getConfiguration","sdpSemantics","catch","origMSTEnabled","ev","enabled","RTCDtmfSender","RTCDTMFSender","RTCPeerConnectionShim","config","iceServers","edgeVersion","hasTurn","server","urls","url","isString","validTurn","startsWith","filterIceServers","shimReplaceTrack","replaceTrack","setTrack","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","preferredMediaSource","code","mediaSource","RTCTrackEvent","mozRTCPeerConnection","modernStatsTypes","inboundrtp","outboundrtp","candidatepair","nativeGetStats","shimSenderGetStats","shimReceiverGetStats","shimRemoveStream","shimRTCDataChannel","DataChannel","RTCDataChannel","shimAddTransceiver","origAddTransceiver","addTransceiver","setParametersPromises","initParameters","shouldPerformCheck","sendEncodings","encodingParam","test","rid","TypeError","parseFloat","scaleResolutionDownBy","RangeError","maxFramerate","getParameters","encodings","setParameters","shimGetParameters","origGetParameters","shimCreateOffer","origCreateOffer","createOffer","all","finally","shimCreateAnswer","origCreateAnswer","createAnswer","shimLocalStreamsAPI","_localStreams","_addTrack","tracks","shimRemoteStreamsAPI","getRemoteStreams","_remoteStreams","_onaddstream","_onaddstreampoly","shimCallbacksAPI","successCallback","failureCallback","options","promise","withCallback","_getUserMedia","shimConstraints","errcb","shimRTCIceServerUrls","OrigPeerConnection","pcConfig","pcConstraints","newIceServers","hasOwnProperty","generateCertificate","shimTrackEventTransceiver","shimCreateOfferLegacy","offerOptions","offerToReceiveAudio","audioTransceiver","getTransceivers","setDirection","offerToReceiveVideo","videoTransceiver","shimAudioContext","AudioContext","webkitAudioContext","shimRTCIceCandidate","NativeRTCIceCandidate","nativeCandidate","parsedCandidate","augmentedCandidate","toJSON","sdpMid","sdpMLineIndex","writable","shimMaxMessageSize","_sctp","sctpInDescription","mLine","getRemoteFirefoxVersion","getCanSendMaxMessageSize","remoteIsFirefox","canSendMaxMessageSize","getMaxMessageSize","isFirefox","canSendMMS","remoteMMS","Number","POSITIVE_INFINITY","shimSendThrowTypeError","wrapDcSend","dc","origDataChannelSend","send","byteLength","readyState","origCreateDataChannel","createDataChannel","dataChannel","channel","shimConnectionState","completed","checking","iceConnectionState","_onconnectionstatechange","origMethod","_connectionstatechangepoly","_lastConnectionState","connectionState","newEvent","removeAllowExtmapMixed","nativeSRD","shimChrome","shimFirefox","shimEdge","shimSafari","logging","adapter","commonShim","browserShim","adapterFactory"],"mappings":"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","file":"27.05c426aa8e30c49805eb.js","sourcesContent":["/* eslint-env node */\n'use strict';\n\n// SDP helpers.\nvar SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(function(line) {\n    return line.trim();\n  });\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  var parts = blob.split('\\nm=');\n  return parts.map(function(part, index) {\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\n  });\n};\n\n// returns the session description.\nSDPUtils.getDescription = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  return sections && sections[0];\n};\n\n// returns the individual media sections.\nSDPUtils.getMediaSections = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  sections.shift();\n  return sections;\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(function(line) {\n    return line.indexOf(prefix) === 0;\n  });\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\nSDPUtils.parseCandidate = function(line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parseInt(parts[1], 10),\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    address: parts[4], // address is an alias for ip.\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compability.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag\n        candidate[parts[i]] = parts[i + 1];\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\nSDPUtils.writeCandidate = function(candidate) {\n  var sdp = [];\n  sdp.push(candidate.foundation);\n  sdp.push(candidate.component);\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.address || candidate.ip);\n  sdp.push(candidate.port);\n\n  var type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress);\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort);\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.usernameFragment || candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.usernameFragment || candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substr(14).split(' ');\n};\n\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  var parts = line.substr(9).split(' ');\n  var parsed = {\n    payloadType: parseInt(parts.shift(), 10) // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  // legacy alias, got renamed back to channels in ORTC.\n  parsed.numChannels = parsed.channels;\n  return parsed;\n};\n\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  var channels = codec.channels || codec.numChannels || 1;\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (channels !== 1 ? '/' + channels : '') + '\\r\\n';\n};\n\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1]\n  };\n};\n\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n        ? '/' + headerExtension.direction\n        : '') +\n      ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses an ftmp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  var parsed = {};\n  var kv;\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (var j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  var line = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    var params = [];\n    Object.keys(codec.parameters).forEach(function(param) {\n      if (codec.parameters[param]) {\n        params.push(param + '=' + codec.parameters[param]);\n      } else {\n        params.push(param);\n      }\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' ')\n  };\n};\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  var lines = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(function(fb) {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses an RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  var sp = line.indexOf(' ');\n  var parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\n  };\n  var colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\nSDPUtils.parseSsrcGroup = function(line) {\n  var parts = line.substr(13).split(' ');\n  return {\n    semantics: parts.shift(),\n    ssrcs: parts.map(function(ssrc) {\n      return parseInt(ssrc, 10);\n    })\n  };\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substr(6);\n  }\n};\n\nSDPUtils.parseFingerprint = function(line) {\n  var parts = line.substr(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1]\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role.\n  // Note2: 'algorithm' is not case sensitive except in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint)\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(function(fp) {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n\n// Parses a=crypto lines into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#dictionary-rtcsrtpsdesparameters-members\nSDPUtils.parseCryptoLine = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    tag: parseInt(parts[0], 10),\n    cryptoSuite: parts[1],\n    keyParams: parts[2],\n    sessionParams: parts.slice(3),\n  };\n};\n\nSDPUtils.writeCryptoLine = function(parameters) {\n  return 'a=crypto:' + parameters.tag + ' ' +\n    parameters.cryptoSuite + ' ' +\n    (typeof parameters.keyParams === 'object'\n      ? SDPUtils.writeCryptoKeyParams(parameters.keyParams)\n      : parameters.keyParams) +\n    (parameters.sessionParams ? ' ' + parameters.sessionParams.join(' ') : '') +\n    '\\r\\n';\n};\n\n// Parses the crypto key parameters into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#rtcsrtpkeyparam*\nSDPUtils.parseCryptoKeyParams = function(keyParams) {\n  if (keyParams.indexOf('inline:') !== 0) {\n    return null;\n  }\n  var parts = keyParams.substr(7).split('|');\n  return {\n    keyMethod: 'inline',\n    keySalt: parts[0],\n    lifeTime: parts[1],\n    mkiValue: parts[2] ? parts[2].split(':')[0] : undefined,\n    mkiLength: parts[2] ? parts[2].split(':')[1] : undefined,\n  };\n};\n\nSDPUtils.writeCryptoKeyParams = function(keyParams) {\n  return keyParams.keyMethod + ':'\n    + keyParams.keySalt +\n    (keyParams.lifeTime ? '|' + keyParams.lifeTime : '') +\n    (keyParams.mkiValue && keyParams.mkiLength\n      ? '|' + keyParams.mkiValue + ':' + keyParams.mkiLength\n      : '');\n};\n\n// Extracts all SDES paramters.\nSDPUtils.getCryptoParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=crypto:');\n  return lines.map(SDPUtils.parseCryptoLine);\n};\n\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  var ufrag = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-ufrag:')[0];\n  var pwd = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-pwd:')[0];\n  if (!(ufrag && pwd)) {\n    return null;\n  }\n  return {\n    usernameFragment: ufrag.substr(12),\n    password: pwd.substr(10),\n  };\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  var description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: []\n  };\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    var pt = mline[i];\n    var rtpmapline = SDPUtils.matchPrefix(\n      mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\n      var fmtps = SDPUtils.matchPrefix(\n        mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  var sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(function(codec) {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(function(codec) {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  var maxptime = 0;\n  caps.codecs.forEach(function(codec) {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n  sdp += 'a=rtcp-mux\\r\\n';\n\n  if (caps.headerExtensions) {\n    caps.headerExtensions.forEach(function(extension) {\n      sdp += SDPUtils.writeExtmap(extension);\n    });\n  }\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  var encodingParameters = [];\n  var description = SDPUtils.parseRtpParameters(mediaSection);\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(parts) {\n      return parts.attribute === 'cname';\n    });\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  var secondarySsrc;\n\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n    .map(function(line) {\n      var parts = line.substr(17).split(' ');\n      return parts.map(function(part) {\n        return parseInt(part, 10);\n      });\n    });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(function(codec) {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      var encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10)\n      };\n      if (primarySsrc && secondarySsrc) {\n        encParam.rtx = {ssrc: secondarySsrc};\n      }\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: primarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(function(params) {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  var rtcpParameters = {};\n\n  // Gets the first SSRC. Note tha with RTX there might be multiple\n  // SSRCs.\n  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(obj) {\n      return obj.attribute === 'cname';\n    })[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrіbute.\n  // Note that Edge does not support unmuxed RTCP.\n  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  var parts;\n  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substr(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(msidParts) {\n      return msidParts.attribute === 'msid';\n    });\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// SCTP\n// parses draft-ietf-mmusic-sctp-sdp-26 first and falls back\n// to draft-ietf-mmusic-sctp-sdp-05\nSDPUtils.parseSctpDescription = function(mediaSection) {\n  var mline = SDPUtils.parseMLine(mediaSection);\n  var maxSizeLine = SDPUtils.matchPrefix(mediaSection, 'a=max-message-size:');\n  var maxMessageSize;\n  if (maxSizeLine.length > 0) {\n    maxMessageSize = parseInt(maxSizeLine[0].substr(19), 10);\n  }\n  if (isNaN(maxMessageSize)) {\n    maxMessageSize = 65536;\n  }\n  var sctpPort = SDPUtils.matchPrefix(mediaSection, 'a=sctp-port:');\n  if (sctpPort.length > 0) {\n    return {\n      port: parseInt(sctpPort[0].substr(12), 10),\n      protocol: mline.fmt,\n      maxMessageSize: maxMessageSize\n    };\n  }\n  var sctpMapLines = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:');\n  if (sctpMapLines.length > 0) {\n    var parts = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:')[0]\n      .substr(10)\n      .split(' ');\n    return {\n      port: parseInt(parts[0], 10),\n      protocol: parts[1],\n      maxMessageSize: maxMessageSize\n    };\n  }\n};\n\n// SCTP\n// outputs the draft-ietf-mmusic-sctp-sdp-26 version that all browsers\n// support by now receiving in this format, unless we originally parsed\n// as the draft-ietf-mmusic-sctp-sdp-05 format (indicated by the m-line\n// protocol of DTLS/SCTP -- without UDP/ or TCP/)\nSDPUtils.writeSctpDescription = function(media, sctp) {\n  var output = [];\n  if (media.protocol !== 'DTLS/SCTP') {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.protocol + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctp-port:' + sctp.port + '\\r\\n'\n    ];\n  } else {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.port + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctpmap:' + sctp.port + ' ' + sctp.protocol + ' 65535\\r\\n'\n    ];\n  }\n  if (sctp.maxMessageSize !== undefined) {\n    output.push('a=max-message-size:' + sctp.maxMessageSize + '\\r\\n');\n  }\n  return output.join('');\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 21);\n};\n\n// Write boilder plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\n// sessUser is optional and defaults to 'thisisadapterortc'\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer, sessUser) {\n  var sessionId;\n  var version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  var user = sessUser || 'thisisadapterortc';\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=' + user + ' ' + sessionId + ' ' + version +\n        ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n    transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n    transceiver.dtlsTransport.getLocalParameters(),\n    type === 'offer' ? 'actpass' : 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.direction) {\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  var lines = SDPUtils.splitLines(mediaSection);\n  for (var i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return mline[0].substr(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var parts = lines[0].substr(2).split(' ');\n  return {\n    kind: parts[0],\n    port: parseInt(parts[1], 10),\n    protocol: parts[2],\n    fmt: parts.slice(3).join(' ')\n  };\n};\n\nSDPUtils.parseOLine = function(mediaSection) {\n  var line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\n  var parts = line.substr(2).split(' ');\n  return {\n    username: parts[0],\n    sessionId: parts[1],\n    sessionVersion: parseInt(parts[2], 10),\n    netType: parts[3],\n    addressType: parts[4],\n    address: parts[5]\n  };\n};\n\n// a very naive interpretation of a valid SDP.\nSDPUtils.isValidSDP = function(blob) {\n  if (typeof blob !== 'string' || blob.length === 0) {\n    return false;\n  }\n  var lines = SDPUtils.splitLines(blob);\n  for (var i = 0; i < lines.length; i++) {\n    if (lines[i].length < 2 || lines[i].charAt(1) !== '=') {\n      return false;\n    }\n    // TODO: check the modifier a bit more.\n  }\n  return true;\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nlet logDisabled_ = true;\nlet deprecationWarnings_ = true;\n\n/**\n * Extract browser version out of the provided user agent string.\n *\n * @param {!string} uastring userAgent string.\n * @param {!string} expr Regular expression used as match criteria.\n * @param {!number} pos position in the version string to be returned.\n * @return {!number} browser version.\n */\nexport function extractVersion(uastring, expr, pos) {\n  const match = uastring.match(expr);\n  return match && match.length >= pos && parseInt(match[pos], 10);\n}\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object (or false to prevent\n// the event).\nexport function wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  const nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    const wrappedCallback = (e) => {\n      const modifiedEvent = wrapper(e);\n      if (modifiedEvent) {\n        if (cb.handleEvent) {\n          cb.handleEvent(modifiedEvent);\n        } else {\n          cb(modifiedEvent);\n        }\n      }\n    };\n    this._eventMap = this._eventMap || {};\n    if (!this._eventMap[eventNameToWrap]) {\n      this._eventMap[eventNameToWrap] = new Map();\n    }\n    this._eventMap[eventNameToWrap].set(cb, wrappedCallback);\n    return nativeAddEventListener.apply(this, [nativeEventName,\n      wrappedCallback]);\n  };\n\n  const nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap\n        || !this._eventMap[eventNameToWrap]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    if (!this._eventMap[eventNameToWrap].has(cb)) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    const unwrappedCb = this._eventMap[eventNameToWrap].get(cb);\n    this._eventMap[eventNameToWrap].delete(cb);\n    if (this._eventMap[eventNameToWrap].size === 0) {\n      delete this._eventMap[eventNameToWrap];\n    }\n    if (Object.keys(this._eventMap).length === 0) {\n      delete this._eventMap;\n    }\n    return nativeRemoveEventListener.apply(this, [nativeEventName,\n      unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get() {\n      return this['_on' + eventNameToWrap];\n    },\n    set(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap] = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n}\n\nexport function disableLog(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  logDisabled_ = bool;\n  return (bool) ? 'adapter.js logging disabled' :\n      'adapter.js logging enabled';\n}\n\n/**\n * Disable or enable deprecation warnings\n * @param {!boolean} bool set to true to disable warnings.\n */\nexport function disableWarnings(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  deprecationWarnings_ = !bool;\n  return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n}\n\nexport function log() {\n  if (typeof window === 'object') {\n    if (logDisabled_) {\n      return;\n    }\n    if (typeof console !== 'undefined' && typeof console.log === 'function') {\n      console.log.apply(console, arguments);\n    }\n  }\n}\n\n/**\n * Shows a deprecation warning suggesting the modern and spec-compatible API.\n */\nexport function deprecated(oldMethod, newMethod) {\n  if (!deprecationWarnings_) {\n    return;\n  }\n  console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\n      ' instead.');\n}\n\n/**\n * Browser detector.\n *\n * @return {object} result containing browser and version\n *     properties.\n */\nexport function detectBrowser(window) {\n  // Returned result object.\n  const result = {browser: null, version: null};\n\n  // Fail early if it's not a browser\n  if (typeof window === 'undefined' || !window.navigator) {\n    result.browser = 'Not a browser.';\n    return result;\n  }\n\n  const {navigator} = window;\n\n  if (navigator.mozGetUserMedia) { // Firefox.\n    result.browser = 'firefox';\n    result.version = extractVersion(navigator.userAgent,\n        /Firefox\\/(\\d+)\\./, 1);\n  } else if (navigator.webkitGetUserMedia ||\n      (window.isSecureContext === false && window.webkitRTCPeerConnection &&\n       !window.RTCIceGatherer)) {\n    // Chrome, Chromium, Webview, Opera.\n    // Version matches Chrome/WebRTC version.\n    // Chrome 74 removed webkitGetUserMedia on http as well so we need the\n    // more complicated fallback to webkitRTCPeerConnection.\n    result.browser = 'chrome';\n    result.version = extractVersion(navigator.userAgent,\n        /Chrom(e|ium)\\/(\\d+)\\./, 2);\n  } else if (navigator.mediaDevices &&\n      navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) { // Edge.\n    result.browser = 'edge';\n    result.version = extractVersion(navigator.userAgent,\n        /Edge\\/(\\d+).(\\d+)$/, 2);\n  } else if (window.RTCPeerConnection &&\n      navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) { // Safari.\n    result.browser = 'safari';\n    result.version = extractVersion(navigator.userAgent,\n        /AppleWebKit\\/(\\d+)\\./, 1);\n    result.supportsUnifiedPlan = window.RTCRtpTransceiver &&\n        'currentDirection' in window.RTCRtpTransceiver.prototype;\n  } else { // Default fallthrough: not supported.\n    result.browser = 'Not a supported browser.';\n    return result;\n  }\n\n  return result;\n}\n\n/**\n * Checks if something is an object.\n *\n * @param {*} val The something you want to check.\n * @return true if val is an object, false otherwise.\n */\nfunction isObject(val) {\n  return Object.prototype.toString.call(val) === '[object Object]';\n}\n\n/**\n * Remove all empty objects and undefined values\n * from a nested object -- an enhanced and vanilla version\n * of Lodash's `compact`.\n */\nexport function compactObject(data) {\n  if (!isObject(data)) {\n    return data;\n  }\n\n  return Object.keys(data).reduce(function(accumulator, key) {\n    const isObj = isObject(data[key]);\n    const value = isObj ? compactObject(data[key]) : data[key];\n    const isEmptyObject = isObj && !Object.keys(value).length;\n    if (value === undefined || isEmptyObject) {\n      return accumulator;\n    }\n    return Object.assign(accumulator, {[key]: value});\n  }, {});\n}\n\n/* iterates the stats graph recursively. */\nexport function walkStats(stats, base, resultSet) {\n  if (!base || resultSet.has(base.id)) {\n    return;\n  }\n  resultSet.set(base.id, base);\n  Object.keys(base).forEach(name => {\n    if (name.endsWith('Id')) {\n      walkStats(stats, stats.get(base[name]), resultSet);\n    } else if (name.endsWith('Ids')) {\n      base[name].forEach(id => {\n        walkStats(stats, stats.get(id), resultSet);\n      });\n    }\n  });\n}\n\n/* filter getStats for a sender/receiver track. */\nexport function filterStats(result, track, outbound) {\n  const streamStatsType = outbound ? 'outbound-rtp' : 'inbound-rtp';\n  const filteredResult = new Map();\n  if (track === null) {\n    return filteredResult;\n  }\n  const trackStats = [];\n  result.forEach(value => {\n    if (value.type === 'track' &&\n        value.trackIdentifier === track.id) {\n      trackStats.push(value);\n    }\n  });\n  trackStats.forEach(trackStat => {\n    result.forEach(stats => {\n      if (stats.type === streamStatsType && stats.trackId === trackStat.id) {\n        walkStats(result, stats, filteredResult);\n      }\n    });\n  });\n  return filteredResult;\n}\n\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\nconst logging = utils.log;\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  if (!navigator.mediaDevices) {\n    return;\n  }\n\n  const browserDetails = utils.detectBrowser(window);\n\n  const constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    const cc = {};\n    Object.keys(c).forEach(key => {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      const r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      const oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        let oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(mix => {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  const shimConstraints_ = function(constraints, func) {\n    if (browserDetails.version >= 61) {\n      return func(constraints);\n    }\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && typeof constraints.audio === 'object') {\n      const remap = function(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      let face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n      const getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\n            !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        let matches;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices()\n          .then(devices => {\n            devices = devices.filter(d => d.kind === 'videoinput');\n            let dev = devices.find(d => matches.some(match =>\n              d.label.toLowerCase().includes(match)));\n            if (!dev && devices.length && matches.includes('back')) {\n              dev = devices[devices.length - 1]; // more likely the back cam\n            }\n            if (dev) {\n              constraints.video.deviceId = face.exact ? {exact: dev.deviceId} :\n                                                        {ideal: dev.deviceId};\n            }\n            constraints.video = constraintsToChrome_(constraints.video);\n            logging('chrome: ' + JSON.stringify(constraints));\n            return func(constraints);\n          });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  const shimError_ = function(e) {\n    if (browserDetails.version >= 64) {\n      return e;\n    }\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        PermissionDismissedError: 'NotAllowedError',\n        InvalidStateError: 'NotAllowedError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotAllowedError',\n        MediaDeviceKillSwitchOn: 'NotAllowedError',\n        TabCaptureError: 'AbortError',\n        ScreenCaptureError: 'AbortError',\n        DeviceCaptureError: 'AbortError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint || e.constraintName,\n      toString() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  const getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, c => {\n      navigator.webkitGetUserMedia(c, onSuccess, e => {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n  navigator.getUserMedia = getUserMedia_.bind(navigator);\n\n  // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n  // function which returns a Promise, it does not accept spec-style\n  // constraints.\n  if (navigator.mediaDevices.getUserMedia) {\n    const origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, c => origGetUserMedia(c).then(stream => {\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(track => {\n            track.stop();\n          });\n          throw new DOMException('', 'NotFoundError');\n        }\n        return stream;\n      }, e => Promise.reject(shimError_(e))));\n    };\n  }\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nexport function shimGetDisplayMedia(window, getSourceId) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  // getSourceId is a function that returns a promise resolving with\n  // the sourceId of the screen/window/tab to be shared.\n  if (typeof getSourceId !== 'function') {\n    console.error('shimGetDisplayMedia: getSourceId argument is not ' +\n        'a function');\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      return getSourceId(constraints)\n        .then(sourceId => {\n          const widthSpecified = constraints.video && constraints.video.width;\n          const heightSpecified = constraints.video &&\n            constraints.video.height;\n          const frameRateSpecified = constraints.video &&\n            constraints.video.frameRate;\n          constraints.video = {\n            mandatory: {\n              chromeMediaSource: 'desktop',\n              chromeMediaSourceId: sourceId,\n              maxFrameRate: frameRateSpecified || 3\n            }\n          };\n          if (widthSpecified) {\n            constraints.video.mandatory.maxWidth = widthSpecified;\n          }\n          if (heightSpecified) {\n            constraints.video.mandatory.maxHeight = heightSpecified;\n          }\n          return window.navigator.mediaDevices.getUserMedia(constraints);\n        });\n    };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\n\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimMediaStream(window) {\n  window.MediaStream = window.MediaStream || window.webkitMediaStream;\n}\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n      window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n      get() {\n        return this._ontrack;\n      },\n      set(f) {\n        if (this._ontrack) {\n          this.removeEventListener('track', this._ontrack);\n        }\n        this.addEventListener('track', this._ontrack = f);\n      },\n      enumerable: true,\n      configurable: true\n    });\n    const origSetRemoteDescription =\n        window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        if (!this._ontrackpoly) {\n          this._ontrackpoly = (e) => {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', te => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === te.track.id);\n              } else {\n                receiver = {track: te.track};\n              }\n\n              const event = new Event('track');\n              event.track = te.track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(track => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === track.id);\n              } else {\n                receiver = {track};\n              }\n              const event = new Event('track');\n              event.track = track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n          };\n          this.addEventListener('addstream', this._ontrackpoly);\n        }\n        return origSetRemoteDescription.apply(this, arguments);\n      };\n  } else {\n    // even if RTCRtpTransceiver is in window, it is only used and\n    // emitted in unified-plan. Unfortunately this means we need\n    // to unconditionally wrap the event.\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      if (!e.transceiver) {\n        Object.defineProperty(e, 'transceiver',\n          {value: {receiver: e.receiver}});\n      }\n      return e;\n    });\n  }\n}\n\nexport function shimGetSendersWithDtmf(window) {\n  // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n  if (typeof window === 'object' && window.RTCPeerConnection &&\n      !('getSenders' in window.RTCPeerConnection.prototype) &&\n      'createDTMFSender' in window.RTCPeerConnection.prototype) {\n    const shimSenderWithDtmf = function(pc, track) {\n      return {\n        track,\n        get dtmf() {\n          if (this._dtmf === undefined) {\n            if (track.kind === 'audio') {\n              this._dtmf = pc.createDTMFSender(track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        },\n        _pc: pc\n      };\n    };\n\n    // augment addTrack when getSenders is not available.\n    if (!window.RTCPeerConnection.prototype.getSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        this._senders = this._senders || [];\n        return this._senders.slice(); // return a copy of the internal state.\n      };\n      const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addTrack =\n        function addTrack(track, stream) {\n          let sender = origAddTrack.apply(this, arguments);\n          if (!sender) {\n            sender = shimSenderWithDtmf(this, track);\n            this._senders.push(sender);\n          }\n          return sender;\n        };\n\n      const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n      window.RTCPeerConnection.prototype.removeTrack =\n        function removeTrack(sender) {\n          origRemoveTrack.apply(this, arguments);\n          const idx = this._senders.indexOf(sender);\n          if (idx !== -1) {\n            this._senders.splice(idx, 1);\n          }\n        };\n    }\n    const origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      this._senders = this._senders || [];\n      origAddStream.apply(this, [stream]);\n      stream.getTracks().forEach(track => {\n        this._senders.push(shimSenderWithDtmf(this, track));\n      });\n    };\n\n    const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        this._senders = this._senders || [];\n        origRemoveStream.apply(this, [stream]);\n\n        stream.getTracks().forEach(track => {\n          const sender = this._senders.find(s => s.track === track);\n          if (sender) { // remove sender\n            this._senders.splice(this._senders.indexOf(sender), 1);\n          }\n        });\n      };\n  } else if (typeof window === 'object' && window.RTCPeerConnection &&\n             'getSenders' in window.RTCPeerConnection.prototype &&\n             'createDTMFSender' in window.RTCPeerConnection.prototype &&\n             window.RTCRtpSender &&\n             !('dtmf' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = this._pc.createDTMFSender(this.track);\n          } else {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n}\n\nexport function shimGetStats(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n\n    // If selector is a function then we are in the old style stats so just\n    // pass back the original getStats format to avoid breaking old users.\n    if (arguments.length > 0 && typeof selector === 'function') {\n      return origGetStats.apply(this, arguments);\n    }\n\n    // When spec-style getStats is supported, return those when called with\n    // either no arguments or the selector argument is null.\n    if (origGetStats.length === 0 && (arguments.length === 0 ||\n        typeof selector !== 'function')) {\n      return origGetStats.apply(this, []);\n    }\n\n    const fixChromeStats_ = function(response) {\n      const standardReport = {};\n      const reports = response.result();\n      reports.forEach(report => {\n        const standardStats = {\n          id: report.id,\n          timestamp: report.timestamp,\n          type: {\n            localcandidate: 'local-candidate',\n            remotecandidate: 'remote-candidate'\n          }[report.type] || report.type\n        };\n        report.names().forEach(name => {\n          standardStats[name] = report.stat(name);\n        });\n        standardReport[standardStats.id] = standardStats;\n      });\n\n      return standardReport;\n    };\n\n    // shim getStats with maplike support\n    const makeMapStats = function(stats) {\n      return new Map(Object.keys(stats).map(key => [key, stats[key]]));\n    };\n\n    if (arguments.length >= 2) {\n      const successCallbackWrapper_ = function(response) {\n        onSucc(makeMapStats(fixChromeStats_(response)));\n      };\n\n      return origGetStats.apply(this, [successCallbackWrapper_,\n        selector]);\n    }\n\n    // promise-support\n    return new Promise((resolve, reject) => {\n      origGetStats.apply(this, [\n        function(response) {\n          resolve(makeMapStats(fixChromeStats_(response)));\n        }, reject]);\n    }).then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender && window.RTCRtpReceiver)) {\n    return;\n  }\n\n  // shim sender stats.\n  if (!('getStats' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    if (origGetSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        const senders = origGetSenders.apply(this, []);\n        senders.forEach(sender => sender._pc = this);\n        return senders;\n      };\n    }\n\n    const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    if (origAddTrack) {\n      window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n        const sender = origAddTrack.apply(this, arguments);\n        sender._pc = this;\n        return sender;\n      };\n    }\n    window.RTCRtpSender.prototype.getStats = function getStats() {\n      const sender = this;\n      return this._pc.getStats().then(result =>\n        /* Note: this will include stats of all senders that\n         *   send a track with the same id as sender.track as\n         *   it is not possible to identify the RTCRtpSender.\n         */\n        utils.filterStats(result, sender.track, true));\n    };\n  }\n\n  // shim receiver stats.\n  if (!('getStats' in window.RTCRtpReceiver.prototype)) {\n    const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n    if (origGetReceivers) {\n      window.RTCPeerConnection.prototype.getReceivers =\n        function getReceivers() {\n          const receivers = origGetReceivers.apply(this, []);\n          receivers.forEach(receiver => receiver._pc = this);\n          return receivers;\n        };\n    }\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      e.receiver._pc = e.srcElement;\n      return e;\n    });\n    window.RTCRtpReceiver.prototype.getStats = function getStats() {\n      const receiver = this;\n      return this._pc.getStats().then(result =>\n        utils.filterStats(result, receiver.track, false));\n    };\n  }\n\n  if (!('getStats' in window.RTCRtpSender.prototype &&\n      'getStats' in window.RTCRtpReceiver.prototype)) {\n    return;\n  }\n\n  // shim RTCPeerConnection.getStats(track).\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    if (arguments.length > 0 &&\n        arguments[0] instanceof window.MediaStreamTrack) {\n      const track = arguments[0];\n      let sender;\n      let receiver;\n      let err;\n      this.getSenders().forEach(s => {\n        if (s.track === track) {\n          if (sender) {\n            err = true;\n          } else {\n            sender = s;\n          }\n        }\n      });\n      this.getReceivers().forEach(r => {\n        if (r.track === track) {\n          if (receiver) {\n            err = true;\n          } else {\n            receiver = r;\n          }\n        }\n        return r.track === track;\n      });\n      if (err || (sender && receiver)) {\n        return Promise.reject(new DOMException(\n          'There are more than one sender or receiver for the track.',\n          'InvalidAccessError'));\n      } else if (sender) {\n        return sender.getStats();\n      } else if (receiver) {\n        return receiver.getStats();\n      }\n      return Promise.reject(new DOMException(\n        'There is no sender or receiver for the track.',\n        'InvalidAccessError'));\n    }\n    return origGetStats.apply(this, arguments);\n  };\n}\n\nexport function shimAddTrackRemoveTrackWithNative(window) {\n  // shim addTrack/removeTrack with native variants in order to make\n  // the interactions with legacy getLocalStreams behave as in other browsers.\n  // Keeps a mapping stream.id => [stream, rtpsenders...]\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      return Object.keys(this._shimmedLocalStreams)\n        .map(streamId => this._shimmedLocalStreams[streamId][0]);\n    };\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (!stream) {\n        return origAddTrack.apply(this, arguments);\n      }\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      const sender = origAddTrack.apply(this, arguments);\n      if (!this._shimmedLocalStreams[stream.id]) {\n        this._shimmedLocalStreams[stream.id] = [stream, sender];\n      } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n        this._shimmedLocalStreams[stream.id].push(sender);\n      }\n      return sender;\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n    });\n    const existingSenders = this.getSenders();\n    origAddStream.apply(this, arguments);\n    const newSenders = this.getSenders()\n      .filter(newSender => existingSenders.indexOf(newSender) === -1);\n    this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      delete this._shimmedLocalStreams[stream.id];\n      return origRemoveStream.apply(this, arguments);\n    };\n\n  const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      if (sender) {\n        Object.keys(this._shimmedLocalStreams).forEach(streamId => {\n          const idx = this._shimmedLocalStreams[streamId].indexOf(sender);\n          if (idx !== -1) {\n            this._shimmedLocalStreams[streamId].splice(idx, 1);\n          }\n          if (this._shimmedLocalStreams[streamId].length === 1) {\n            delete this._shimmedLocalStreams[streamId];\n          }\n        });\n      }\n      return origRemoveTrack.apply(this, arguments);\n    };\n}\n\nexport function shimAddTrackRemoveTrack(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const browserDetails = utils.detectBrowser(window);\n  // shim addTrack and removeTrack.\n  if (window.RTCPeerConnection.prototype.addTrack &&\n      browserDetails.version >= 65) {\n    return shimAddTrackRemoveTrackWithNative(window);\n  }\n\n  // also shim pc.getLocalStreams when addTrack is shimmed\n  // to return the original streams.\n  const origGetLocalStreams = window.RTCPeerConnection.prototype\n      .getLocalStreams;\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      const nativeStreams = origGetLocalStreams.apply(this);\n      this._reverseStreams = this._reverseStreams || {};\n      return nativeStreams.map(stream => this._reverseStreams[stream.id]);\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n    });\n    // Add identity mapping for consistency with addTrack.\n    // Unless this is being used with a stream from addTrack.\n    if (!this._reverseStreams[stream.id]) {\n      const newStream = new window.MediaStream(stream.getTracks());\n      this._streams[stream.id] = newStream;\n      this._reverseStreams[newStream.id] = stream;\n      stream = newStream;\n    }\n    origAddStream.apply(this, [stream]);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n\n      origRemoveStream.apply(this, [(this._streams[stream.id] || stream)]);\n      delete this._reverseStreams[(this._streams[stream.id] ?\n          this._streams[stream.id].id : stream.id)];\n      delete this._streams[stream.id];\n    };\n\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      const streams = [].slice.call(arguments, 1);\n      if (streams.length !== 1 ||\n          !streams[0].getTracks().find(t => t === track)) {\n        // this is not fully correct but all we can manage without\n        // [[associated MediaStreams]] internal slot.\n        throw new DOMException(\n          'The adapter.js addTrack polyfill only supports a single ' +\n          ' stream which is associated with the specified track.',\n          'NotSupportedError');\n      }\n\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n      const oldStream = this._streams[stream.id];\n      if (oldStream) {\n        // this is using odd Chrome behaviour, use with caution:\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n        // Note: we rely on the high-level addTrack/dtmf shim to\n        // create the sender with a dtmf sender.\n        oldStream.addTrack(track);\n\n        // Trigger ONN async.\n        Promise.resolve().then(() => {\n          this.dispatchEvent(new Event('negotiationneeded'));\n        });\n      } else {\n        const newStream = new window.MediaStream([track]);\n        this._streams[stream.id] = newStream;\n        this._reverseStreams[newStream.id] = stream;\n        this.addStream(newStream);\n      }\n      return this.getSenders().find(s => s.track === track);\n    };\n\n  // replace the internal stream id with the external one and\n  // vice versa.\n  function replaceInternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(internalStream.id, 'g'),\n          externalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  function replaceExternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(externalStream.id, 'g'),\n          internalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  ['createOffer', 'createAnswer'].forEach(function(method) {\n    const nativeMethod = window.RTCPeerConnection.prototype[method];\n    const methodObj = {[method]() {\n      const args = arguments;\n      const isLegacyCall = arguments.length &&\n          typeof arguments[0] === 'function';\n      if (isLegacyCall) {\n        return nativeMethod.apply(this, [\n          (description) => {\n            const desc = replaceInternalStreamId(this, description);\n            args[0].apply(null, [desc]);\n          },\n          (err) => {\n            if (args[1]) {\n              args[1].apply(null, err);\n            }\n          }, arguments[2]\n        ]);\n      }\n      return nativeMethod.apply(this, arguments)\n      .then(description => replaceInternalStreamId(this, description));\n    }};\n    window.RTCPeerConnection.prototype[method] = methodObj[method];\n  });\n\n  const origSetLocalDescription =\n      window.RTCPeerConnection.prototype.setLocalDescription;\n  window.RTCPeerConnection.prototype.setLocalDescription =\n    function setLocalDescription() {\n      if (!arguments.length || !arguments[0].type) {\n        return origSetLocalDescription.apply(this, arguments);\n      }\n      arguments[0] = replaceExternalStreamId(this, arguments[0]);\n      return origSetLocalDescription.apply(this, arguments);\n    };\n\n  // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n  const origLocalDescription = Object.getOwnPropertyDescriptor(\n      window.RTCPeerConnection.prototype, 'localDescription');\n  Object.defineProperty(window.RTCPeerConnection.prototype,\n      'localDescription', {\n        get() {\n          const description = origLocalDescription.get.apply(this);\n          if (description.type === '') {\n            return description;\n          }\n          return replaceInternalStreamId(this, description);\n        }\n      });\n\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      // We can not yet check for sender instanceof RTCRtpSender\n      // since we shim RTPSender. So we check if sender._pc is set.\n      if (!sender._pc) {\n        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +\n            'does not implement interface RTCRtpSender.', 'TypeError');\n      }\n      const isLocal = sender._pc === this;\n      if (!isLocal) {\n        throw new DOMException('Sender was not created by this connection.',\n            'InvalidAccessError');\n      }\n\n      // Search for the native stream the senders track belongs to.\n      this._streams = this._streams || {};\n      let stream;\n      Object.keys(this._streams).forEach(streamid => {\n        const hasTrack = this._streams[streamid].getTracks()\n          .find(track => sender.track === track);\n        if (hasTrack) {\n          stream = this._streams[streamid];\n        }\n      });\n\n      if (stream) {\n        if (stream.getTracks().length === 1) {\n          // if this is the last track of the stream, remove the stream. This\n          // takes care of any shimmed _senders.\n          this.removeStream(this._reverseStreams[stream.id]);\n        } else {\n          // relying on the same odd chrome behaviour as above.\n          stream.removeTrack(sender.track);\n        }\n        this.dispatchEvent(new Event('negotiationneeded'));\n      }\n    };\n}\n\nexport function shimPeerConnection(window) {\n  const browserDetails = utils.detectBrowser(window);\n\n  if (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.webkitRTCPeerConnection;\n  }\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  const addIceCandidateNullSupported =\n    window.RTCPeerConnection.prototype.addIceCandidate.length === 0;\n\n  // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n  if (browserDetails.version < 53) {\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          const nativeMethod = window.RTCPeerConnection.prototype[method];\n          const methodObj = {[method]() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          }};\n          window.RTCPeerConnection.prototype[method] = methodObj[method];\n        });\n  }\n\n  // support for addIceCandidate(null or undefined)\n  const nativeAddIceCandidate =\n      window.RTCPeerConnection.prototype.addIceCandidate;\n  window.RTCPeerConnection.prototype.addIceCandidate =\n    function addIceCandidate() {\n      if (!addIceCandidateNullSupported && !arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\n      // in older versions. Native support planned for Chrome M77.\n      if (browserDetails.version < 78 &&\n        arguments[0] && arguments[0].candidate === '') {\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n}\n\n// Attempt to fix ONN in plan-b mode.\nexport function fixNegotiationNeeded(window) {\n  const browserDetails = utils.detectBrowser(window);\n  utils.wrapPeerConnectionEvent(window, 'negotiationneeded', e => {\n    const pc = e.target;\n    if (browserDetails.version < 72 || (pc.getConfiguration &&\n        pc.getConfiguration().sdpSemantics === 'plan-b')) {\n      if (pc.signalingState !== 'stable') {\n        return;\n      }\n    }\n    return e;\n  });\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  const shimError_ = function(e) {\n    return {\n      name: {PermissionDeniedError: 'NotAllowedError'}[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint,\n      toString() {\n        return this.name;\n      }\n    };\n  };\n\n  // getUserMedia error shim.\n  const origGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n  navigator.mediaDevices.getUserMedia = function(c) {\n    return origGetUserMedia(c).catch(e => Promise.reject(shimError_(e)));\n  };\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nexport function shimGetDisplayMedia(window) {\n  if (!('getDisplayMedia' in window.navigator)) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    window.navigator.getDisplayMedia.bind(window.navigator);\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\nimport {filterIceServers} from './filtericeservers';\nimport shimRTCPeerConnection from 'rtcpeerconnection-shim';\n\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimPeerConnection(window) {\n  const browserDetails = utils.detectBrowser(window);\n\n  if (window.RTCIceGatherer) {\n    if (!window.RTCIceCandidate) {\n      window.RTCIceCandidate = function RTCIceCandidate(args) {\n        return args;\n      };\n    }\n    if (!window.RTCSessionDescription) {\n      window.RTCSessionDescription = function RTCSessionDescription(args) {\n        return args;\n      };\n    }\n    // this adds an additional event listener to MediaStrackTrack that signals\n    // when a tracks enabled property was changed. Workaround for a bug in\n    // addStream, see below. No longer required in 15025+\n    if (browserDetails.version < 15025) {\n      const origMSTEnabled = Object.getOwnPropertyDescriptor(\n          window.MediaStreamTrack.prototype, 'enabled');\n      Object.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {\n        set(value) {\n          origMSTEnabled.set.call(this, value);\n          const ev = new Event('enabled');\n          ev.enabled = value;\n          this.dispatchEvent(ev);\n        }\n      });\n    }\n  }\n\n  // ORTC defines the DTMF sender a bit different.\n  // https://github.com/w3c/ortc/issues/714\n  if (window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = new window.RTCDtmfSender(this);\n          } else if (this.track.kind === 'video') {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n  // Edge currently only implements the RTCDtmfSender, not the\n  // RTCDTMFSender alias. See http://draft.ortc.org/#rtcdtmfsender2*\n  if (window.RTCDtmfSender && !window.RTCDTMFSender) {\n    window.RTCDTMFSender = window.RTCDtmfSender;\n  }\n\n  const RTCPeerConnectionShim = shimRTCPeerConnection(window,\n      browserDetails.version);\n  window.RTCPeerConnection = function RTCPeerConnection(config) {\n    if (config && config.iceServers) {\n      config.iceServers = filterIceServers(config.iceServers,\n        browserDetails.version);\n      utils.log('ICE servers after filtering:', config.iceServers);\n    }\n    return new RTCPeerConnectionShim(config);\n  };\n  window.RTCPeerConnection.prototype = RTCPeerConnectionShim.prototype;\n}\n\nexport function shimReplaceTrack(window) {\n  // ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614\n  if (window.RTCRtpSender &&\n      !('replaceTrack' in window.RTCRtpSender.prototype)) {\n    window.RTCRtpSender.prototype.replaceTrack =\n        window.RTCRtpSender.prototype.setTrack;\n  }\n}\n","/*\n *  Copyright (c) 2018 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nexport function filterIceServers(iceServers, edgeVersion) {\n  let hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(server => {\n    if (server && (server.urls || server.url)) {\n      let urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n      }\n      const isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(url => {\n        // filter STUN unconditionally.\n        if (url.indexOf('stun:') === 0) {\n          return false;\n        }\n\n        const validTurn = url.startsWith('turn') &&\n            !url.startsWith('turn:[') &&\n            url.includes('transport=udp');\n        if (validTurn && !hasTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return validTurn && !hasTurn;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n\nexport function shimGetUserMedia(window) {\n  const browserDetails = utils.detectBrowser(window);\n  const navigator = window && window.navigator;\n  const MediaStreamTrack = window && window.MediaStreamTrack;\n\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n        'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    const remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    const nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      const nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        const obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      const nativeApplyConstraints =\n        MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nexport function shimGetDisplayMedia(window, preferredMediaSource) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      if (!(constraints && constraints.video)) {\n        const err = new DOMException('getDisplayMedia without video ' +\n            'constraints is undefined');\n        err.name = 'NotFoundError';\n        // from https://heycam.github.io/webidl/#idl-DOMException-error-names\n        err.code = 8;\n        return Promise.reject(err);\n      }\n      if (constraints.video === true) {\n        constraints.video = {mediaSource: preferredMediaSource};\n      } else {\n        constraints.video.mediaSource = preferredMediaSource;\n      }\n      return window.navigator.mediaDevices.getUserMedia(constraints);\n    };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      ('receiver' in window.RTCTrackEvent.prototype) &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimPeerConnection(window) {\n  const browserDetails = utils.detectBrowser(window);\n\n  if (typeof window !== 'object' ||\n      !(window.RTCPeerConnection || window.mozRTCPeerConnection)) {\n    return; // probably media.peerconnection.enabled=false in about:config\n  }\n  if (!window.RTCPeerConnection && window.mozRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.mozRTCPeerConnection;\n  }\n\n  if (browserDetails.version < 53) {\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          const nativeMethod = window.RTCPeerConnection.prototype[method];\n          const methodObj = {[method]() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          }};\n          window.RTCPeerConnection.prototype[method] = methodObj[method];\n        });\n  }\n\n  // support for addIceCandidate(null or undefined)\n  // as well as ignoring {sdpMid, candidate: \"\"}\n  if (browserDetails.version < 68) {\n    const nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate =\n    function addIceCandidate() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\n      // in older versions.\n      if (arguments[0] && arguments[0].candidate === '') {\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n  }\n\n  const modernStatsTypes = {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  };\n\n  const nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n    return nativeGetStats.apply(this, [selector || null])\n      .then(stats => {\n        if (browserDetails.version < 53 && !onSucc) {\n          // Shim only promise getStats with spec-hyphens in type names\n          // Leave callback version alone; misc old uses of forEach before Map\n          try {\n            stats.forEach(stat => {\n              stat.type = modernStatsTypes[stat.type] || stat.type;\n            });\n          } catch (e) {\n            if (e.name !== 'TypeError') {\n              throw e;\n            }\n            // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n            stats.forEach((stat, i) => {\n              stats.set(i, Object.assign({}, stat, {\n                type: modernStatsTypes[stat.type] || stat.type\n              }));\n            });\n          }\n        }\n        return stats;\n      })\n      .then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {\n    return;\n  }\n  const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n  if (origGetSenders) {\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n  }\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  if (origAddTrack) {\n    window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n      const sender = origAddTrack.apply(this, arguments);\n      sender._pc = this;\n      return sender;\n    };\n  }\n  window.RTCRtpSender.prototype.getStats = function getStats() {\n    return this.track ? this._pc.getStats(this.track) :\n        Promise.resolve(new Map());\n  };\n}\n\nexport function shimReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {\n    return;\n  }\n  const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n  if (origGetReceivers) {\n    window.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\n      const receivers = origGetReceivers.apply(this, []);\n      receivers.forEach(receiver => receiver._pc = this);\n      return receivers;\n    };\n  }\n  utils.wrapPeerConnectionEvent(window, 'track', e => {\n    e.receiver._pc = e.srcElement;\n    return e;\n  });\n  window.RTCRtpReceiver.prototype.getStats = function getStats() {\n    return this._pc.getStats(this.track);\n  };\n}\n\nexport function shimRemoveStream(window) {\n  if (!window.RTCPeerConnection ||\n      'removeStream' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(sender => {\n        if (sender.track && stream.getTracks().includes(sender.track)) {\n          this.removeTrack(sender);\n        }\n      });\n    };\n}\n\nexport function shimRTCDataChannel(window) {\n  // rename DataChannel to RTCDataChannel (native fix in FF60):\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1173851\n  if (window.DataChannel && !window.RTCDataChannel) {\n    window.RTCDataChannel = window.DataChannel;\n  }\n}\n\nexport function shimAddTransceiver(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origAddTransceiver = window.RTCPeerConnection.prototype.addTransceiver;\n  if (origAddTransceiver) {\n    window.RTCPeerConnection.prototype.addTransceiver =\n      function addTransceiver() {\n        this.setParametersPromises = [];\n        const initParameters = arguments[1];\n        const shouldPerformCheck = initParameters &&\n                                  'sendEncodings' in initParameters;\n        if (shouldPerformCheck) {\n          // If sendEncodings params are provided, validate grammar\n          initParameters.sendEncodings.forEach((encodingParam) => {\n            if ('rid' in encodingParam) {\n              const ridRegex = /^[a-z0-9]{0,16}$/i;\n              if (!ridRegex.test(encodingParam.rid)) {\n                throw new TypeError('Invalid RID value provided.');\n              }\n            }\n            if ('scaleResolutionDownBy' in encodingParam) {\n              if (!(parseFloat(encodingParam.scaleResolutionDownBy) >= 1.0)) {\n                throw new RangeError('scale_resolution_down_by must be >= 1.0');\n              }\n            }\n            if ('maxFramerate' in encodingParam) {\n              if (!(parseFloat(encodingParam.maxFramerate) >= 0)) {\n                throw new RangeError('max_framerate must be >= 0.0');\n              }\n            }\n          });\n        }\n        const transceiver = origAddTransceiver.apply(this, arguments);\n        if (shouldPerformCheck) {\n          // Check if the init options were applied. If not we do this in an\n          // asynchronous way and save the promise reference in a global object.\n          // This is an ugly hack, but at the same time is way more robust than\n          // checking the sender parameters before and after the createOffer\n          // Also note that after the createoffer we are not 100% sure that\n          // the params were asynchronously applied so we might miss the\n          // opportunity to recreate offer.\n          const {sender} = transceiver;\n          const params = sender.getParameters();\n          if (!('encodings' in params) ||\n              // Avoid being fooled by patched getParameters() below.\n              (params.encodings.length === 1 &&\n               Object.keys(params.encodings[0]).length === 0)) {\n            params.encodings = initParameters.sendEncodings;\n            sender.sendEncodings = initParameters.sendEncodings;\n            this.setParametersPromises.push(sender.setParameters(params)\n              .then(() => {\n                delete sender.sendEncodings;\n              }).catch(() => {\n                delete sender.sendEncodings;\n              })\n            );\n          }\n        }\n        return transceiver;\n      };\n  }\n}\n\nexport function shimGetParameters(window) {\n  if (!(typeof window === 'object' && window.RTCRtpSender)) {\n    return;\n  }\n  const origGetParameters = window.RTCRtpSender.prototype.getParameters;\n  if (origGetParameters) {\n    window.RTCRtpSender.prototype.getParameters =\n      function getParameters() {\n        const params = origGetParameters.apply(this, arguments);\n        if (!('encodings' in params)) {\n          params.encodings = [].concat(this.sendEncodings || [{}]);\n        }\n        return params;\n      };\n  }\n}\n\nexport function shimCreateOffer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer = function createOffer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n      .then(() => {\n        return origCreateOffer.apply(this, arguments);\n      })\n      .finally(() => {\n        this.setParametersPromises = [];\n      });\n    }\n    return origCreateOffer.apply(this, arguments);\n  };\n}\n\nexport function shimCreateAnswer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateAnswer = window.RTCPeerConnection.prototype.createAnswer;\n  window.RTCPeerConnection.prototype.createAnswer = function createAnswer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n      .then(() => {\n        return origCreateAnswer.apply(this, arguments);\n      })\n      .finally(() => {\n        this.setParametersPromises = [];\n      });\n    }\n    return origCreateAnswer.apply(this, arguments);\n  };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nimport * as utils from '../utils';\n\nexport function shimLocalStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getLocalStreams =\n      function getLocalStreams() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n  }\n  if (!('addStream' in window.RTCPeerConnection.prototype)) {\n    const _addTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      if (!this._localStreams) {\n        this._localStreams = [];\n      }\n      if (!this._localStreams.includes(stream)) {\n        this._localStreams.push(stream);\n      }\n      // Try to emulate Chrome's behaviour of adding in audio-video order.\n      // Safari orders by track id.\n      stream.getAudioTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n      stream.getVideoTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n    };\n\n    window.RTCPeerConnection.prototype.addTrack =\n      function addTrack(track, ...streams) {\n        if (streams) {\n          streams.forEach((stream) => {\n            if (!this._localStreams) {\n              this._localStreams = [stream];\n            } else if (!this._localStreams.includes(stream)) {\n              this._localStreams.push(stream);\n            }\n          });\n        }\n        return _addTrack.apply(this, arguments);\n      };\n  }\n  if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        const index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        const tracks = stream.getTracks();\n        this.getSenders().forEach(sender => {\n          if (tracks.includes(sender.track)) {\n            this.removeTrack(sender);\n          }\n        });\n      };\n  }\n}\n\nexport function shimRemoteStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getRemoteStreams =\n      function getRemoteStreams() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n  }\n  if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n      get() {\n        return this._onaddstream;\n      },\n      set(f) {\n        if (this._onaddstream) {\n          this.removeEventListener('addstream', this._onaddstream);\n          this.removeEventListener('track', this._onaddstreampoly);\n        }\n        this.addEventListener('addstream', this._onaddstream = f);\n        this.addEventListener('track', this._onaddstreampoly = (e) => {\n          e.streams.forEach(stream => {\n            if (!this._remoteStreams) {\n              this._remoteStreams = [];\n            }\n            if (this._remoteStreams.includes(stream)) {\n              return;\n            }\n            this._remoteStreams.push(stream);\n            const event = new Event('addstream');\n            event.stream = stream;\n            this.dispatchEvent(event);\n          });\n        });\n      }\n    });\n    const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        const pc = this;\n        if (!this._onaddstreampoly) {\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            e.streams.forEach(stream => {\n              if (!pc._remoteStreams) {\n                pc._remoteStreams = [];\n              }\n              if (pc._remoteStreams.indexOf(stream) >= 0) {\n                return;\n              }\n              pc._remoteStreams.push(stream);\n              const event = new Event('addstream');\n              event.stream = stream;\n              pc.dispatchEvent(event);\n            });\n          });\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n  }\n}\n\nexport function shimCallbacksAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  const prototype = window.RTCPeerConnection.prototype;\n  const origCreateOffer = prototype.createOffer;\n  const origCreateAnswer = prototype.createAnswer;\n  const setLocalDescription = prototype.setLocalDescription;\n  const setRemoteDescription = prototype.setRemoteDescription;\n  const addIceCandidate = prototype.addIceCandidate;\n\n  prototype.createOffer =\n    function createOffer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  prototype.createAnswer =\n    function createAnswer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  let withCallback = function(description, successCallback, failureCallback) {\n    const promise = setLocalDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setLocalDescription = withCallback;\n\n  withCallback = function(description, successCallback, failureCallback) {\n    const promise = setRemoteDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setRemoteDescription = withCallback;\n\n  withCallback = function(candidate, successCallback, failureCallback) {\n    const promise = addIceCandidate.apply(this, [candidate]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.addIceCandidate = withCallback;\n}\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    // shim not needed in Safari 12.1\n    const mediaDevices = navigator.mediaDevices;\n    const _getUserMedia = mediaDevices.getUserMedia.bind(mediaDevices);\n    navigator.mediaDevices.getUserMedia = (constraints) => {\n      return _getUserMedia(shimConstraints(constraints));\n    };\n  }\n\n  if (!navigator.getUserMedia && navigator.mediaDevices &&\n    navigator.mediaDevices.getUserMedia) {\n    navigator.getUserMedia = function getUserMedia(constraints, cb, errcb) {\n      navigator.mediaDevices.getUserMedia(constraints)\n      .then(cb, errcb);\n    }.bind(navigator);\n  }\n}\n\nexport function shimConstraints(constraints) {\n  if (constraints && constraints.video !== undefined) {\n    return Object.assign({},\n      constraints,\n      {video: utils.compactObject(constraints.video)}\n    );\n  }\n\n  return constraints;\n}\n\nexport function shimRTCIceServerUrls(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n  const OrigPeerConnection = window.RTCPeerConnection;\n  window.RTCPeerConnection =\n    function RTCPeerConnection(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        const newIceServers = [];\n        for (let i = 0; i < pcConfig.iceServers.length; i++) {\n          let server = pcConfig.iceServers[i];\n          if (!server.hasOwnProperty('urls') &&\n              server.hasOwnProperty('url')) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n  window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n  // wrap static methods. Currently just generateCertificate.\n  if ('generateCertificate' in OrigPeerConnection) {\n    Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n      get() {\n        return OrigPeerConnection.generateCertificate;\n      }\n    });\n  }\n}\n\nexport function shimTrackEventTransceiver(window) {\n  // Add event.transceiver member over deprecated event.receiver\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      'receiver' in window.RTCTrackEvent.prototype &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimCreateOfferLegacy(window) {\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer =\n    function createOffer(offerOptions) {\n      if (offerOptions) {\n        if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveAudio =\n            !!offerOptions.offerToReceiveAudio;\n        }\n        const audioTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'audio');\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('sendonly');\n            } else {\n              audioTransceiver.direction = 'sendonly';\n            }\n          } else if (audioTransceiver.direction === 'recvonly') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('inactive');\n            } else {\n              audioTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          this.addTransceiver('audio');\n        }\n\n        if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveVideo =\n            !!offerOptions.offerToReceiveVideo;\n        }\n        const videoTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'video');\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('sendonly');\n            } else {\n              videoTransceiver.direction = 'sendonly';\n            }\n          } else if (videoTransceiver.direction === 'recvonly') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('inactive');\n            } else {\n              videoTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          this.addTransceiver('video');\n        }\n      }\n      return origCreateOffer.apply(this, arguments);\n    };\n}\n\nexport function shimAudioContext(window) {\n  if (typeof window !== 'object' || window.AudioContext) {\n    return;\n  }\n  window.AudioContext = window.webkitAudioContext;\n}\n","/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport SDPUtils from 'sdp';\nimport * as utils from './utils';\n\nexport function shimRTCIceCandidate(window) {\n  // foundation is arbitrarily chosen as an indicator for full support for\n  // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n  if (!window.RTCIceCandidate || (window.RTCIceCandidate && 'foundation' in\n      window.RTCIceCandidate.prototype)) {\n    return;\n  }\n\n  const NativeRTCIceCandidate = window.RTCIceCandidate;\n  window.RTCIceCandidate = function RTCIceCandidate(args) {\n    // Remove the a= which shouldn't be part of the candidate string.\n    if (typeof args === 'object' && args.candidate &&\n        args.candidate.indexOf('a=') === 0) {\n      args = JSON.parse(JSON.stringify(args));\n      args.candidate = args.candidate.substr(2);\n    }\n\n    if (args.candidate && args.candidate.length) {\n      // Augment the native candidate with the parsed fields.\n      const nativeCandidate = new NativeRTCIceCandidate(args);\n      const parsedCandidate = SDPUtils.parseCandidate(args.candidate);\n      const augmentedCandidate = Object.assign(nativeCandidate,\n          parsedCandidate);\n\n      // Add a serializer that does not serialize the extra attributes.\n      augmentedCandidate.toJSON = function toJSON() {\n        return {\n          candidate: augmentedCandidate.candidate,\n          sdpMid: augmentedCandidate.sdpMid,\n          sdpMLineIndex: augmentedCandidate.sdpMLineIndex,\n          usernameFragment: augmentedCandidate.usernameFragment,\n        };\n      };\n      return augmentedCandidate;\n    }\n    return new NativeRTCIceCandidate(args);\n  };\n  window.RTCIceCandidate.prototype = NativeRTCIceCandidate.prototype;\n\n  // Hook up the augmented candidate in onicecandidate and\n  // addEventListener('icecandidate', ...)\n  utils.wrapPeerConnectionEvent(window, 'icecandidate', e => {\n    if (e.candidate) {\n      Object.defineProperty(e, 'candidate', {\n        value: new window.RTCIceCandidate(e.candidate),\n        writable: 'false'\n      });\n    }\n    return e;\n  });\n}\n\nexport function shimMaxMessageSize(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const browserDetails = utils.detectBrowser(window);\n\n  if (!('sctp' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'sctp', {\n      get() {\n        return typeof this._sctp === 'undefined' ? null : this._sctp;\n      }\n    });\n  }\n\n  const sctpInDescription = function(description) {\n    if (!description || !description.sdp) {\n      return false;\n    }\n    const sections = SDPUtils.splitSections(description.sdp);\n    sections.shift();\n    return sections.some(mediaSection => {\n      const mLine = SDPUtils.parseMLine(mediaSection);\n      return mLine && mLine.kind === 'application'\n          && mLine.protocol.indexOf('SCTP') !== -1;\n    });\n  };\n\n  const getRemoteFirefoxVersion = function(description) {\n    // TODO: Is there a better solution for detecting Firefox?\n    const match = description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);\n    if (match === null || match.length < 2) {\n      return -1;\n    }\n    const version = parseInt(match[1], 10);\n    // Test for NaN (yes, this is ugly)\n    return version !== version ? -1 : version;\n  };\n\n  const getCanSendMaxMessageSize = function(remoteIsFirefox) {\n    // Every implementation we know can send at least 64 KiB.\n    // Note: Although Chrome is technically able to send up to 256 KiB, the\n    //       data does not reach the other peer reliably.\n    //       See: https://bugs.chromium.org/p/webrtc/issues/detail?id=8419\n    let canSendMaxMessageSize = 65536;\n    if (browserDetails.browser === 'firefox') {\n      if (browserDetails.version < 57) {\n        if (remoteIsFirefox === -1) {\n          // FF < 57 will send in 16 KiB chunks using the deprecated PPID\n          // fragmentation.\n          canSendMaxMessageSize = 16384;\n        } else {\n          // However, other FF (and RAWRTC) can reassemble PPID-fragmented\n          // messages. Thus, supporting ~2 GiB when sending.\n          canSendMaxMessageSize = 2147483637;\n        }\n      } else if (browserDetails.version < 60) {\n        // Currently, all FF >= 57 will reset the remote maximum message size\n        // to the default value when a data channel is created at a later\n        // stage. :(\n        // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n        canSendMaxMessageSize =\n          browserDetails.version === 57 ? 65535 : 65536;\n      } else {\n        // FF >= 60 supports sending ~2 GiB\n        canSendMaxMessageSize = 2147483637;\n      }\n    }\n    return canSendMaxMessageSize;\n  };\n\n  const getMaxMessageSize = function(description, remoteIsFirefox) {\n    // Note: 65536 bytes is the default value from the SDP spec. Also,\n    //       every implementation we know supports receiving 65536 bytes.\n    let maxMessageSize = 65536;\n\n    // FF 57 has a slightly incorrect default remote max message size, so\n    // we need to adjust it here to avoid a failure when sending.\n    // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1425697\n    if (browserDetails.browser === 'firefox'\n         && browserDetails.version === 57) {\n      maxMessageSize = 65535;\n    }\n\n    const match = SDPUtils.matchPrefix(description.sdp,\n      'a=max-message-size:');\n    if (match.length > 0) {\n      maxMessageSize = parseInt(match[0].substr(19), 10);\n    } else if (browserDetails.browser === 'firefox' &&\n                remoteIsFirefox !== -1) {\n      // If the maximum message size is not present in the remote SDP and\n      // both local and remote are Firefox, the remote peer can receive\n      // ~2 GiB.\n      maxMessageSize = 2147483637;\n    }\n    return maxMessageSize;\n  };\n\n  const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n    function setRemoteDescription() {\n      this._sctp = null;\n      // Chrome decided to not expose .sctp in plan-b mode.\n      // As usual, adapter.js has to do an 'ugly worakaround'\n      // to cover up the mess.\n      if (browserDetails.browser === 'chrome' && browserDetails.version >= 76) {\n        const {sdpSemantics} = this.getConfiguration();\n        if (sdpSemantics === 'plan-b') {\n          Object.defineProperty(this, 'sctp', {\n            get() {\n              return typeof this._sctp === 'undefined' ? null : this._sctp;\n            },\n            enumerable: true,\n            configurable: true,\n          });\n        }\n      }\n\n      if (sctpInDescription(arguments[0])) {\n        // Check if the remote is FF.\n        const isFirefox = getRemoteFirefoxVersion(arguments[0]);\n\n        // Get the maximum message size the local peer is capable of sending\n        const canSendMMS = getCanSendMaxMessageSize(isFirefox);\n\n        // Get the maximum message size of the remote peer.\n        const remoteMMS = getMaxMessageSize(arguments[0], isFirefox);\n\n        // Determine final maximum message size\n        let maxMessageSize;\n        if (canSendMMS === 0 && remoteMMS === 0) {\n          maxMessageSize = Number.POSITIVE_INFINITY;\n        } else if (canSendMMS === 0 || remoteMMS === 0) {\n          maxMessageSize = Math.max(canSendMMS, remoteMMS);\n        } else {\n          maxMessageSize = Math.min(canSendMMS, remoteMMS);\n        }\n\n        // Create a dummy RTCSctpTransport object and the 'maxMessageSize'\n        // attribute.\n        const sctp = {};\n        Object.defineProperty(sctp, 'maxMessageSize', {\n          get() {\n            return maxMessageSize;\n          }\n        });\n        this._sctp = sctp;\n      }\n\n      return origSetRemoteDescription.apply(this, arguments);\n    };\n}\n\nexport function shimSendThrowTypeError(window) {\n  if (!(window.RTCPeerConnection &&\n      'createDataChannel' in window.RTCPeerConnection.prototype)) {\n    return;\n  }\n\n  // Note: Although Firefox >= 57 has a native implementation, the maximum\n  //       message size can be reset for all data channels at a later stage.\n  //       See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n\n  function wrapDcSend(dc, pc) {\n    const origDataChannelSend = dc.send;\n    dc.send = function send() {\n      const data = arguments[0];\n      const length = data.length || data.size || data.byteLength;\n      if (dc.readyState === 'open' &&\n          pc.sctp && length > pc.sctp.maxMessageSize) {\n        throw new TypeError('Message too large (can send a maximum of ' +\n          pc.sctp.maxMessageSize + ' bytes)');\n      }\n      return origDataChannelSend.apply(dc, arguments);\n    };\n  }\n  const origCreateDataChannel =\n    window.RTCPeerConnection.prototype.createDataChannel;\n  window.RTCPeerConnection.prototype.createDataChannel =\n    function createDataChannel() {\n      const dataChannel = origCreateDataChannel.apply(this, arguments);\n      wrapDcSend(dataChannel, this);\n      return dataChannel;\n    };\n  utils.wrapPeerConnectionEvent(window, 'datachannel', e => {\n    wrapDcSend(e.channel, e.target);\n    return e;\n  });\n}\n\n\n/* shims RTCConnectionState by pretending it is the same as iceConnectionState.\n * See https://bugs.chromium.org/p/webrtc/issues/detail?id=6145#c12\n * for why this is a valid hack in Chrome. In Firefox it is slightly incorrect\n * since DTLS failures would be hidden. See\n * https://bugzilla.mozilla.org/show_bug.cgi?id=1265827\n * for the Firefox tracking bug.\n */\nexport function shimConnectionState(window) {\n  if (!window.RTCPeerConnection ||\n      'connectionState' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  Object.defineProperty(proto, 'connectionState', {\n    get() {\n      return {\n        completed: 'connected',\n        checking: 'connecting'\n      }[this.iceConnectionState] || this.iceConnectionState;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(proto, 'onconnectionstatechange', {\n    get() {\n      return this._onconnectionstatechange || null;\n    },\n    set(cb) {\n      if (this._onconnectionstatechange) {\n        this.removeEventListener('connectionstatechange',\n            this._onconnectionstatechange);\n        delete this._onconnectionstatechange;\n      }\n      if (cb) {\n        this.addEventListener('connectionstatechange',\n            this._onconnectionstatechange = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ['setLocalDescription', 'setRemoteDescription'].forEach((method) => {\n    const origMethod = proto[method];\n    proto[method] = function() {\n      if (!this._connectionstatechangepoly) {\n        this._connectionstatechangepoly = e => {\n          const pc = e.target;\n          if (pc._lastConnectionState !== pc.connectionState) {\n            pc._lastConnectionState = pc.connectionState;\n            const newEvent = new Event('connectionstatechange', e);\n            pc.dispatchEvent(newEvent);\n          }\n          return e;\n        };\n        this.addEventListener('iceconnectionstatechange',\n          this._connectionstatechangepoly);\n      }\n      return origMethod.apply(this, arguments);\n    };\n  });\n}\n\nexport function removeAllowExtmapMixed(window) {\n  /* remove a=extmap-allow-mixed for webrtc.org < M71 */\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const browserDetails = utils.detectBrowser(window);\n  if (browserDetails.browser === 'chrome' && browserDetails.version >= 71) {\n    return;\n  }\n  if (browserDetails.browser === 'safari' && browserDetails.version >= 605) {\n    return;\n  }\n  const nativeSRD = window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n  function setRemoteDescription(desc) {\n    if (desc && desc.sdp && desc.sdp.indexOf('\\na=extmap-allow-mixed') !== -1) {\n      desc.sdp = desc.sdp.split('\\n').filter((line) => {\n        return line.trim() !== 'a=extmap-allow-mixed';\n      }).join('\\n');\n    }\n    return nativeSRD.apply(this, arguments);\n  };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n\n'use strict';\n\nimport {adapterFactory} from './adapter_factory.js';\n\nconst adapter =\n  adapterFactory({window: typeof window === 'undefined' ? undefined : window});\nexport default adapter;\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\nimport * as utils from './utils';\n\n  // Browser shims.\nimport * as chromeShim from './chrome/chrome_shim';\nimport * as edgeShim from './edge/edge_shim';\nimport * as firefoxShim from './firefox/firefox_shim';\nimport * as safariShim from './safari/safari_shim';\nimport * as commonShim from './common_shim';\n\n// Shimming starts here.\nexport function adapterFactory({window} = {}, options = {\n  shimChrome: true,\n  shimFirefox: true,\n  shimEdge: true,\n  shimSafari: true,\n}) {\n  // Utils.\n  const logging = utils.log;\n  const browserDetails = utils.detectBrowser(window);\n\n  const adapter = {\n    browserDetails,\n    commonShim,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings\n  };\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      if (browserDetails.version === null) {\n        logging('Chrome shim can not determine version, not shimming.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n\n      chromeShim.shimGetUserMedia(window);\n      chromeShim.shimMediaStream(window);\n      chromeShim.shimPeerConnection(window);\n      chromeShim.shimOnTrack(window);\n      chromeShim.shimAddTrackRemoveTrack(window);\n      chromeShim.shimGetSendersWithDtmf(window);\n      chromeShim.shimGetStats(window);\n      chromeShim.shimSenderReceiverGetStats(window);\n      chromeShim.fixNegotiationNeeded(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimConnectionState(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      commonShim.removeAllowExtmapMixed(window);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n\n      firefoxShim.shimGetUserMedia(window);\n      firefoxShim.shimPeerConnection(window);\n      firefoxShim.shimOnTrack(window);\n      firefoxShim.shimRemoveStream(window);\n      firefoxShim.shimSenderGetStats(window);\n      firefoxShim.shimReceiverGetStats(window);\n      firefoxShim.shimRTCDataChannel(window);\n      firefoxShim.shimAddTransceiver(window);\n      firefoxShim.shimGetParameters(window);\n      firefoxShim.shimCreateOffer(window);\n      firefoxShim.shimCreateAnswer(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimConnectionState(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      break;\n    case 'edge':\n      if (!edgeShim || !edgeShim.shimPeerConnection || !options.shimEdge) {\n        logging('MS edge shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming edge.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = edgeShim;\n\n      edgeShim.shimGetUserMedia(window);\n      edgeShim.shimGetDisplayMedia(window);\n      edgeShim.shimPeerConnection(window);\n      edgeShim.shimReplaceTrack(window);\n\n      // the edge shim implements the full RTCIceCandidate object.\n\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n\n      safariShim.shimRTCIceServerUrls(window);\n      safariShim.shimCreateOfferLegacy(window);\n      safariShim.shimCallbacksAPI(window);\n      safariShim.shimLocalStreamsAPI(window);\n      safariShim.shimRemoteStreamsAPI(window);\n      safariShim.shimTrackEventTransceiver(window);\n      safariShim.shimGetUserMedia(window);\n      safariShim.shimAudioContext(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      commonShim.removeAllowExtmapMixed(window);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n}\n"],"sourceRoot":""}